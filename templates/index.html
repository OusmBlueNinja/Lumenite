<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Live Chatroom</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        #messages { max-height: 400px; overflow-y: auto; }
        .message { padding: 5px; border-bottom: 1px solid #ddd; }
        .timestamp { font-size: 0.8em; color: #888; float: right; }
    </style>
</head>
<body class="bg-dark text-light">
<div class="container mt-5">
    <h1 class="mb-4">Live Chatroom</h1>
    <div id="messages" class="bg-light text-dark rounded p-3 mb-3"></div>
    <form id="chatForm">
        <input type="text" id="msg" class="form-control mb-2" placeholder="Type a message..." autocomplete="off">
        <button class="btn btn-primary">Send</button>
    </form>
</div>

<script>
    async function fetchMessages() {
        const res = await fetch("/api/messages");
        const data = await res.json();
        const container = document.getElementById("messages");
        container.innerHTML = "";
        data.forEach(obj => {
            const div = document.createElement("div");
            div.className = "message";
            div.innerHTML = `<span>${obj.msg}</span><span class="timestamp">${obj.time}</span>`;
            container.appendChild(div);
        });
        container.scrollTop = container.scrollHeight;
    }

    document.getElementById("chatForm").addEventListener("submit", async e => {
        e.preventDefault();
        const msg = encodeURIComponent(document.getElementById("msg").value);
        if (!msg) return;
        await fetch(`/api/send?msg=${msg}`);
        document.getElementById("msg").value = "";
        fetchMessages();
    });

    setInterval(fetchMessages, 1000);
    fetchMessages();
</script>
</body>
</html>
